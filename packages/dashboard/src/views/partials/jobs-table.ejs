<table class="table rounded-lg">
  <thead class="bg-neutral text-neutral-content">
    <tr>
      <th class="px-4 py-3">ID</th>
      <th class="px-4 py-3">Class</th>
      <th class="px-4 py-3">Queue</th>
      <th class="px-4 py-3">State</th>
      <th class="px-4 py-3">Attempts</th>
      <th class="px-4 py-3">Available At</th>
      <th class="px-4 py-3">Completed At</th>
      <th class="px-4 py-3">Claimed By</th>
      <th class="max-w-3"></th>
    </tr>
  </thead>
  <tbody>
    <% jobs.forEach(job => { %>
    <tr class="hover:bg-base-300">
      <td class="px-2 py-3 text-base-content link"><a href="/jobs/<%= job.id %>"><%= job.id %></a></td>
      <td class="px-2 py-3 text-base-content"><%= job.class %></td>
      <td class="px-2 py-3"><%= job.queue %></td>
      <td class="px-2 py-3">
        <span class="badge <%= {
            completed: 'badge-success',
            failed: 'badge-error',
            canceled: 'badge-secondary',
            waiting: 'badge-warning',
            claimed: 'badge-info',
            running: 'badge-primary',
          }[job.state] || 'badge-neutral' %>">
          <%= job.state.charAt(0).toUpperCase() + job.state.slice(1) %>
        </span>
      </td>
      <td class="px-2 py-3"><%= job.attempt %> / <%= job.max_attempts %></td>
      <td class="px-2 py-3"><%= job.available_at?.toISOString?.() || '-' %></td>
      <td class="px-2 py-3"><%= job.completed_at?.toISOString?.() || '-' %></td>
      <td class="px-2 py-3 text-base-content"><%= job.claimed_by || '-' %></td>
      <td class="px-2 py-3 flex flex-nowrap gap-2">
        <% if (job.available_at > new Date()) { %>
          <button type="button" class="btn btn-sm" hx-patch="/jobs/<%= job.id %>/run"><i data-feather="play" class="w-4 h-4"></i>Run</button>
        <% } %>
        <% if (!['canceled', 'failed', 'completed'].includes(job.state)){ %>
          <button type="button" class="btn btn-sm" hx-patch="/jobs/<%= job.id %>/cancel"><i data-feather="x" class="w-4 h-4"></i>Cancel</button>
        <% } %>
      </td>
    </tr>
    <% }) %>
  </tbody>
</table>

<div class="join mt-4">
  <% if (pagination.page > 1) { %>
  <button type="button" class="join-item btn btn-sm" hx-get="/jobs" hx-target="#jobs-table" hx-include="#filter-form"
    hx-vals='{"page": <%= pagination.page - 1 %>}'>«</button>
  <% } else { %>
  <button class="join-item btn btn-sm btn-disabled">«</button>
  <% } %>

  <button class="join-item btn btn-sm btn-active" data-current-page="<%= pagination.page %>">
    Page <%= pagination.page %>
  </button>

  <% if (pagination.hasNextPage) { %>
  <button type="button" class="join-item btn btn-sm" hx-get="/jobs" hx-target="#jobs-table" hx-include="#filter-form"
    hx-vals='{"page": <%= pagination.page + 1 %>}'>»</button>
  <% } else { %>
  <button class="join-item btn btn-sm btn-disabled">»</button>
  <% } %>
</div>

<input type="hidden" name="page" id="current-page" value="<%= pagination.page %>">